[←Previous(02_Architecture(en).md) | [Next→](04_UI(en).md) | [Top](00_Technical_documents(en).md)  

## 3\. Core Components  
    Drive Indicator AI is structured so that multiple independent components work together.  
    This section provides a detailed explanation of each component's role, internal structure,  
    and relationship with other components.  

### 3.1 SettingsManager — The Core of Settings Management  

#### 3.1.1 Role  
    ･ Reading and writing settings files (JSON)  
    ･ Persisting settings values  
    ･ Providing default values  
    ･ Maintaining values ​​that affect the overall behavior of the app,  
      such as language, DPI, and log settings  

#### 3.1.2 Main Functions  
    ･ Load()   : Loads settings files  
    ･ Save()   : Writes settings to settings files  
    ･ Current  : Current settings instance  
    ･ DefLangCode / DefLangName  : Default language values  
    ･ SizeChangeDpi  : DPI switching threshold (16px ↔ 32px)  

#### 3.1.3 Relationship with Other Components  
      ･ TrayIconManager  : Refers to the update interval and monitored drives  
      ･ IconRenderer     : Refers to the DPI value  
      ･ LangManager      : Refers to the language code  
      ･ LogHelper        : See Logging Enabled/Disabled  
    The app-wide setting is set to "Single Source of Truth".  

## 3.2 TrayIconManager — Notification Area Icon Manager  

#### 3.2.1 Role  
    ･ Generates and updates task tray icons  
    ･ Builds context menus  
    ･ Serves as the central link between DriveMonitor and IconRenderer  
    ･ Manages the application's main loop  

#### 3.2.2 Main Functions  
    ･ Start()             : Starts the monitoring and icon update loop  
    ･ UpdateIcons()       : Reflects icons generated by IconRenderer to the tray  
    ･ PrepareTempIcons()  : Extracts icon PNGs to TEMP  
    ･ ApplyLanguage()     : Localizes menus  
    ･ Dispose()           : Disposes of icons and stops ETW  

#### 3.2.3 Relationship with Other Components  
      ･ DriveMonitor     : Obtains DriveStatus\[]  
      ･ IconRenderer     : Requests icon drawing  
      ･ SettingsManager  : Checks the update interval and monitored drives  
      ･ LangManager      : Menu translation  
      ･ LogHelper        : Logging internal operations  
    This component serves as the "command center" for the Drive Indicator AI.  

### 3.3 DriveMonitor — The Core of I/O Monitoring  

#### 3.3.1 Role  
    ･ Acquires the I/O status of each drive and summarizes it in DriveStatus  
    ･ Normal drive → PerformanceCounter  
    ･ RAM drive    → ETW (EtwRamIoMonitor)  

#### 3.3.2 Main Functions  
    ･ Update()          : Acquires I/O for all drives  
    ･ GetDriveStatus()  : Generates DriveStatus  
    ･ StartEtwMonitor() / StopEtwMonitor()  : Monitors the RAM drive  

#### 3.3.3 Contents of DriveStatus  
    ･ DriveLetter  
    ･ IsReadActive  
    ･ IsWriteActive  
    ･ ReadBytes  
    ･ WriteBytes  

#### 3.3.4 Relationship with Other Components  
      ･ EtwRamIoMonitor  : Acquires I/O for the RAM drive  
      ･ TrayIconManager  : Passes DriveStatus\[]  
      ･ SettingsManager  : Refers to monitored drives  
      ･ LogHelper        : Records monitoring errors  
    This component acts as the "sensor" for the Drive Indicator AI.  

### 3.4 EtwRamIoMonitor — High-Precision Monitoring Dedicated to RAM Drives  

#### 3.4.1 Role  
    ･ Monitors RAM drive I/O using ETW (Event Tracing for Windows)  
    ･ Analyzes FileIORead / FileIOWrite events  
    ･ Provides I/O information to DriveMonitor  

#### 3.4.2 Main Functions
    ･ Start()         : Starts an ETW session  
    ･ Stop()          : Stops an ETW session  
    ･ ProcessEvent()  : Analyzes events  
    ･ Safe termination using a CancellationToken  

#### 3.4.3 Technical Features  
      ･ Uses TraceEventSession  
      ･ Avoids session name collisions  
      ･ Accurately captures RAM drive I/O (difficult with general tools)  
    A key component supporting Drive Indicator AI's "advanced monitoring capabilities".  

### 3.5 IconRenderer — The center of DPI-aware icon rendering  

#### 3.5.1 Role  
    ･ Composites PNG images based on DriveStatus and generates icons  
    ･ Automatically switches between 16px and 32px depending on DPI  
    ･ Font rendering of DriveLetter  
    ･ Safely destroys handles with Win32 DestroyIcon  

#### 3.5.2 Main Functions  
    ･ RenderIcons()     : Iconizes multiple drives collectively  
    ･ RenderIcon()      : Draws a single icon  
    ･ LoadDriveImage()  : Loads PNG images  
    ･ IconSize / DriveSize / LetterSize: Calculates size based on DPI  

#### 3.5.3 Relationship with Other Components  
      ･ FontHelper       : Font cache  
      ･ SettingsManager  : DPI and text color  
      ･ TrayIconManager  : Passes rendering results  
    Drive Indicator AI This component creates the "look" of the screen.  

### 3.6 FontHelper — DPI-Aware Font Caching  

#### 3.6.1 Role  
    ･ Caches fonts according to the DPI to prevent unnecessary generation  
    ･ Uses GraphicsUnit.Pixel to absorb DPI differences  

#### 3.6.2 Main Functions  
      ･ GetDriveLetterFontCache()  : Retrieves fonts from the cache  
      ･ FontCreat()   : Generates fonts  
      ･ ClearCache()  : Disposes and clears the cache  
    This is why text appears beautifully even in DPI environments.  

### 3.7 LogHelper — Log Management (with Rotation)  

#### 3.7.1 Role  
    ･ Saves logs to TEMP  
    ･ Rotates to .old when logs exceed 1MB  
    ･ Thread-safe writing  

#### 3.7.2 Main Functions  
      ･ LogWrite()  : Writes logs  
      ･ ClearLog()  : Deletes logs  
      ･ Automatically creates log folders  
    Supports the "transparency" and "ease of debugging" of Drive Indicator AI.  

### 3.8 LangManager — JSON-Based Multilingual Support  

#### 3.8.1 Role  
    ･ Loads language files (lang_xx.json)  
    ･ Manages translation tables  
    ･ Retrieves UI text by key  

#### 3.8.2 Main Functions  
      ･ Lang.Load()          : Loads translation tables  
      ･ Lang.T()             : Retrieves translated strings  
      ･ LoadLanguagesJson()  : Loads a list of languages  
      ･ Converts language names to and from language codes  
    The foundation supporting the internationalization of Drive Indicator AI.  

[←Previous](02_Architecture(en).md) | [Next→](04_UI(en).md) | [Top](00_Technical_Documents.md)  